// OTP authentication
Flow io.jans.test
     Basepath ""
     Timeout 100 seconds
     Configs config
     Inputs credentialMap otpPassed userExists otpResult
// initialize Credential Map
initializeCredentialMap | exception = Call io.jans.test.UserCheck#initializeSomething credentialMap
// Enter username
credentialU = RRF "username.ftlh" 
// check userExists
resultUserExists | exceptionResultUserExists = Call io.jans.test.UserCheck#userExists username
// Print exceptionResultUserExists
Log "@error exceptionResultUserExists : " exceptionResultUserExists
// userExists
Log "@info userExists : " resultUserExists
// User does not exist
When resultUserExists is false
     // User not enrolled
     it_lveqz = { success: false, error: "User not enrolled" }
     Finish it_lveqz
// Prompt for OTP
Log "@info Assume user recieves an OTP"
// OTP form
credentialOtp = RRF "otp.ftlh" 
// Printing OTP
Log "@info credentialOtp" 
// Validate OTP
otpResult | exception = Call io.jans.test.UserCheck#validateOTP credentialOtp
// OTP valid
When otpResult is true
     // Successful flow
     Log "@info Success"
     // Flow complete
     it_hcbcf = { success: true, data: { userId: username } }
     Finish it_hcbcf
// OTP validation failed
Log "@error OTP validation failed"
// Incorrect OTP
it_eateh = { success: false, error: "OTP wrong" }
Finish it_eateh